# 👥 用户管理系统

## ✨ 功能概述

完整的管理员用户管理系统，支持查看、编辑、启用/禁用和删除用户。

## 🎯 主要功能

### 1. 用户列表展示
- ✅ 表格形式展示所有用户
- ✅ 显示用户基本信息（用户名、邮箱）
- ✅ 显示用户角色和状态
- ✅ 显示健康记录数量
- ✅ 显示最后登录时间
- ✅ 显示注册时间

### 2. 搜索和筛选
- 🔍 **关键词搜索**：支持搜索用户名和邮箱
- 🎚️ **角色筛选**：普通用户 / 管理员
- 🎚️ **状态筛选**：已启用 / 已禁用
- 🔄 **重置筛选**：一键清除所有筛选条件

### 3. 用户状态管理
- ✅ **启用用户**：允许用户登录和使用系统
- ❌ **禁用用户**：阻止用户登录（保留数据）
- 🔒 **安全限制**：管理员不能禁用自己

### 4. 角色管理
- 👤 **普通用户**：使用健康计算器和查看历史
- 👑 **管理员**：拥有所有权限 + 用户管理
- 🔄 **角色切换**：下拉菜单快速切换角色
- 🔒 **安全限制**：管理员不能修改自己的角色

### 5. 用户删除
- 🗑️ **永久删除**：删除用户及其所有数据
- ⚠️ **二次确认**：防止误删除
- 🔒 **安全限制**：管理员不能删除自己

### 6. 数据统计
- 📊 **总用户数**：系统所有用户
- ✅ **已启用用户**：当前活跃用户数
- ❌ **已禁用用户**：被禁用的用户数
- 👑 **管理员数量**：系统管理员数量

### 7. 分页功能
- 📄 **每页20条**：优化加载速度
- ⬅️➡️ **上一页/下一页**：便捷翻页
- 📈 **显示进度**：当前页/总页数

## 📱 界面布局

```
┌─────────────────────────────────────────────────┐
│              Header (顶部导航)                   │
├─────────────────────────────────────────────────┤
│ 👑 用户管理                                      │
│ 管理系统中的所有用户                              │
├─────────────────────────────────────────────────┤
│ [搜索] [角色筛选] [状态筛选] [重置]              │
├─────────────────────────────────────────────────┤
│  📊 总用户  ✅ 已启用  ❌ 已禁用  👑 管理员       │
│     100        95         5         2           │
├─────────────────────────────────────────────────┤
│ 用户列表表格：                                   │
│ ┌─────────────────────────────────────────┐     │
│ │用户│角色│状态│记录│最后登录│注册│操作│     │
│ ├─────────────────────────────────────────┤     │
│ │user1│👤│✓│10│2024-11-07│...│禁用│删除│     │
│ │user2│👑│✓│50│2024-11-06│...│禁用│删除│     │
│ │...                                      │     │
│ └─────────────────────────────────────────┘     │
├─────────────────────────────────────────────────┤
│ 显示 1-20 条    [上一页] 第1/5页 [下一页]       │
└─────────────────────────────────────────────────┘
```

## 🛠️ 使用说明

### 访问用户管理

1. **从管理员面板进入**
   - 登录管理员账户
   - 访问 `/admin`
   - 点击"👥 用户管理"卡片

2. **直接访问**
   - URL: `/admin/users`
   - 需要管理员权限

### 搜索用户

1. 在搜索框输入用户名或邮箱
2. 实时过滤显示结果
3. 支持模糊搜索

### 筛选用户

**按角色筛选**：
```
所有角色 / 普通用户 / 管理员
```

**按状态筛选**：
```
所有状态 / 已启用 / 已禁用
```

### 启用/禁用用户

1. 找到目标用户
2. 点击操作列的"启用"或"禁用"按钮
3. 确认操作
4. 列表自动刷新

**效果**：
- **禁用用户**：无法登录，但数据保留
- **启用用户**：恢复正常使用

### 修改用户角色

1. 找到目标用户
2. 点击角色列的下拉菜单
3. 选择新角色（普通用户 / 管理员👑）
4. 确认操作
5. 列表自动刷新

**注意**：
- ⚠️ 不能修改自己的角色
- 👑 管理员拥有所有权限

### 删除用户

1. 找到目标用户
2. 点击操作列的"删除"按钮
3. 确认删除（⚠️ 此操作不可恢复）
4. 列表自动刷新

**警告**：
- 🗑️ 删除用户会删除所有关联数据
- 📊 包括所有健康记录
- ⚠️ 此操作无法撤销
- 🔒 不能删除自己

## 📊 用户数据统计

### 显示的信息

| 字段 | 说明 |
|------|------|
| 用户名 | 用户的显示名称 |
| 邮箱 | 用户的邮箱地址 |
| 角色 | 普通用户 / 管理员👑 |
| 状态 | ✓ 已启用 / ✕ 已禁用 |
| 记录数 | BMI + BMR + 体脂率记录总数 |
| 最后登录 | 最近一次登录时间 |
| 注册时间 | 账户创建时间 |

### 统计卡片

```
┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐
│  总用户  │ │  已启用  │ │  已禁用  │ │  管理员  │
│   100    │ │    95    │ │    5     │ │    2     │
└──────────┘ └──────────┘ └──────────┘ └──────────┘
```

## 🔐 权限和安全

### 访问权限

- ✅ **管理员**：完全访问
- ❌ **普通用户**：自动跳转到仪表板
- ❌ **未登录**：自动跳转到登录页

### 操作限制

| 操作 | 自己 | 其他用户 |
|------|------|----------|
| 查看信息 | ✅ | ✅ |
| 修改角色 | ❌ | ✅ |
| 启用/禁用 | ❌ | ✅ |
| 删除账户 | ❌ | ✅ |

### API 保护

所有管理员 API 都受 `requireAdmin()` 保护：
```typescript
await requireAdmin() // 验证管理员权限
```

## 🎨 视觉设计

### 状态标识

**已启用**：
```
✓ 已启用  (绿色背景)
```

**已禁用**：
```
✕ 已禁用  (红色背景)
```

### 角色标识

**普通用户**：
```
👤 普通用户
```

**管理员**：
```
👑 管理员
```

### 操作按钮

- **启用/禁用**：蓝色文字
- **删除**：红色文字
- **禁用状态**：灰色（不可点击）

## 🔗 API 端点

### 获取用户列表
```
GET /api/admin/users
Query: page, limit, role, isActive
```

### 获取用户详情
```
GET /api/admin/users/:id
```

### 更新用户
```
PATCH /api/admin/users/:id
Body: { role?, isActive? }
```

### 删除用户
```
DELETE /api/admin/users/:id
```

## 📱 响应式设计

### 桌面端（≥768px）
- 完整表格显示
- 所有列都可见
- 舒适的点击区域

### 移动端（<768px）
- 水平滚动表格
- 保持所有功能
- 触摸友好的按钮

## 💡 使用场景

### 1. 新用户审核
```
场景：新用户注册后需要审核
流程：查看用户 → 确认信息 → 启用/禁用
```

### 2. 处理问题用户
```
场景：用户违规需要处理
流程：搜索用户 → 禁用账户 → 通知用户
```

### 3. 提升管理员
```
场景：需要添加新管理员
流程：找到用户 → 修改角色为管理员 → 通知用户
```

### 4. 清理测试账户
```
场景：删除测试或废弃账户
流程：筛选用户 → 删除账户 → 确认删除
```

## 🚀 高级功能（规划中）

- [ ] 批量操作（批量启用/禁用）
- [ ] 用户详情页面
- [ ] 用户活动日志
- [ ] 导出用户数据
- [ ] 用户统计图表
- [ ] 邮件通知功能
- [ ] 用户分组管理
- [ ] 权限细粒度控制

## 📝 开发者注意事项

### 添加新的用户字段

如果需要在列表中显示更多用户信息：

1. **更新 API 查询**：
```typescript
// src/app/api/admin/users/route.ts
select: {
  // ... 现有字段
  newField: true,
}
```

2. **更新 TypeScript 接口**：
```typescript
// src/app/admin/users/page.tsx
interface User {
  // ... 现有字段
  newField: string
}
```

3. **更新表格列**：
```tsx
<th>新字段</th>
// ...
<td>{user.newField}</td>
```

### 添加新的筛选条件

```typescript
const [filters, setFilters] = useState({
  // ... 现有筛选
  newFilter: '',
})

// 在 fetchUsers 中添加
if (filters.newFilter) params.append('newFilter', filters.newFilter)
```

## ✅ 测试清单

- [x] 管理员可以访问用户管理页面
- [x] 普通用户被重定向
- [x] 未登录用户被重定向到登录页
- [x] 搜索功能正常工作
- [x] 角色筛选正常工作
- [x] 状态筛选正常工作
- [x] 启用/禁用功能正常
- [x] 角色修改功能正常
- [x] 删除功能正常
- [x] 分页功能正常
- [x] 统计数据正确显示
- [x] 不能操作自己的账户
- [x] 所有操作有确认提示
- [x] 响应式布局正常

## 🐛 已知限制

目前没有已知的功能性问题。

## 📚 相关文档

- 用户角色系统：`ROLES.md`
- 管理员设置：`ADMIN_SETUP.md`
- API 文档：`README.md`

---

**创建日期**: 2024-11-07  
**版本**: v1.5.0  
**状态**: ✅ 完成并测试

