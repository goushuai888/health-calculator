# ç®¡ç†å‘˜é‡ç½®ç”¨æˆ·å¯†ç åŠŸèƒ½

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

ç®¡ç†å‘˜å¯ä»¥åœ¨ç”¨æˆ·ç®¡ç†é¡µé¢ç›´æ¥é‡ç½®ä»»ä½•ç”¨æˆ·çš„å¯†ç ï¼Œæ–¹ä¾¿å¤„ç†ç”¨æˆ·å¿˜è®°å¯†ç çš„æƒ…å†µã€‚

---

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### 1. é‡ç½®å¯†ç æŒ‰é’®
- åœ¨ç”¨æˆ·ç®¡ç†é¡µé¢çš„æ“ä½œåˆ—ä¸­æ·»åŠ "é‡ç½®å¯†ç "æŒ‰é’®
- ç®¡ç†å‘˜ä¸èƒ½é‡ç½®è‡ªå·±çš„å¯†ç ï¼ˆéœ€é€šè¿‡ä¿®æ”¹å¯†ç åŠŸèƒ½ï¼‰
- æŒ‰é’®æ˜¾ç¤ºä¸ºæ©™è‰²ï¼ŒåŒºåˆ«äºå…¶ä»–æ“ä½œ

### 2. é‡ç½®å¯†ç å¼¹çª—
- ç¾è§‚çš„æ¨¡æ€å¼¹çª—ç•Œé¢
- æ˜¾ç¤ºè¦é‡ç½®å¯†ç çš„ç”¨æˆ·å
- æç¤ºç”¨æˆ·é‡ç½®åéœ€è¦ä½¿ç”¨æ–°å¯†ç ç™»å½•

### 3. å¯†ç éªŒè¯
- **æœ€å°é•¿åº¦**ï¼š6 ä¸ªå­—ç¬¦
- **äºŒæ¬¡ç¡®è®¤**ï¼šéœ€è¦è¾“å…¥ä¸¤æ¬¡å¯†ç 
- **å®æ—¶éªŒè¯**ï¼šå³æ—¶æ˜¾ç¤ºéªŒè¯é”™è¯¯

### 4. å®‰å…¨æªæ–½
- å¯†ç ä½¿ç”¨ bcrypt åŠ å¯†å­˜å‚¨
- ä»…ç®¡ç†å‘˜å¯è®¿é—® API
- é˜²æ­¢é‡ç½®è‡ªå·±çš„å¯†ç 
- å®Œæ•´çš„æƒé™éªŒè¯

---

## ğŸ”Œ API ç«¯ç‚¹

### POST /api/admin/users/[id]/reset-password

**æƒé™**ï¼šä»…ç®¡ç†å‘˜

**è¯·æ±‚ä½“**ï¼š
```json
{
  "newPassword": "æ–°å¯†ç ï¼ˆè‡³å°‘6ä¸ªå­—ç¬¦ï¼‰"
}
```

**å“åº”ï¼ˆæˆåŠŸï¼‰**ï¼š
```json
{
  "success": true,
  "message": "ç”¨æˆ· \"username\" çš„å¯†ç å·²æˆåŠŸé‡ç½®"
}
```

**å“åº”ï¼ˆå¤±è´¥ï¼‰**ï¼š
```json
{
  "error": "é”™è¯¯ä¿¡æ¯"
}
```

**çŠ¶æ€ç **ï¼š
- `200` - æˆåŠŸ
- `400` - è¯·æ±‚å‚æ•°é”™è¯¯
- `401` - æœªç™»å½•
- `403` - éç®¡ç†å‘˜
- `404` - ç”¨æˆ·ä¸å­˜åœ¨
- `500` - æœåŠ¡å™¨é”™è¯¯

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### ç®¡ç†å‘˜ç«¯æ“ä½œ

1. **è®¿é—®ç”¨æˆ·ç®¡ç†é¡µé¢**
   ```
   https://health-calculator.edgeone.app/admin/users
   ```

2. **æ‰¾åˆ°è¦é‡ç½®å¯†ç çš„ç”¨æˆ·**
   - å¯ä»¥ä½¿ç”¨æœç´¢åŠŸèƒ½æŸ¥æ‰¾
   - å¯ä»¥ä½¿ç”¨ç­›é€‰åŠŸèƒ½è¿‡æ»¤

3. **ç‚¹å‡»"é‡ç½®å¯†ç "æŒ‰é’®**
   - åœ¨ç”¨æˆ·æ‰€åœ¨è¡Œçš„æ“ä½œåˆ—
   - æ©™è‰²çš„"é‡ç½®å¯†ç "æŒ‰é’®

4. **åœ¨å¼¹çª—ä¸­è¾“å…¥æ–°å¯†ç **
   - è¾“å…¥æ–°å¯†ç ï¼ˆè‡³å°‘6ä¸ªå­—ç¬¦ï¼‰
   - å†æ¬¡è¾“å…¥ç¡®è®¤å¯†ç 
   - ç¡®ä¿ä¸¤æ¬¡å¯†ç ä¸€è‡´

5. **ç‚¹å‡»"ç¡®è®¤é‡ç½®"**
   - ç³»ç»Ÿä¼šéªŒè¯å¯†ç æ ¼å¼
   - æˆåŠŸåæ˜¾ç¤ºæç¤ºä¿¡æ¯
   - å¼¹çª—è‡ªåŠ¨å…³é—­

6. **é€šçŸ¥ç”¨æˆ·**
   - é€šè¿‡å…¶ä»–æ–¹å¼å‘ŠçŸ¥ç”¨æˆ·æ–°å¯†ç 
   - å»ºè®®ç”¨æˆ·é¦–æ¬¡ç™»å½•åä¿®æ”¹å¯†ç 

### ç”¨æˆ·ç«¯æ“ä½œ

ç”¨æˆ·æ”¶åˆ°æ–°å¯†ç åï¼š

1. **ä½¿ç”¨æ–°å¯†ç ç™»å½•**
   ```
   https://health-calculator.edgeone.app/login
   ```

2. **ï¼ˆå»ºè®®ï¼‰ä¿®æ”¹å¯†ç **
   - ç™»å½•åè¿›å…¥ä¸ªäººè®¾ç½®
   - ä¿®æ”¹ä¸ºè‡ªå·±çš„å¯†ç 

---

## ğŸ”’ å®‰å…¨è€ƒè™‘

### 1. æƒé™æ§åˆ¶
- âœ… ä»…ç®¡ç†å‘˜å¯è®¿é—®é‡ç½®å¯†ç åŠŸèƒ½
- âœ… ç®¡ç†å‘˜ä¸èƒ½é‡ç½®è‡ªå·±çš„å¯†ç 
- âœ… API å±‚é¢çš„æƒé™éªŒè¯

### 2. å¯†ç å®‰å…¨
- âœ… å¯†ç ä½¿ç”¨ bcrypt åŠ å¯†ï¼ˆsalt rounds: 10ï¼‰
- âœ… æ–°å¯†ç ä¸ä¼šåœ¨æ—¥å¿—ä¸­æ˜¾ç¤º
- âœ… æœ€å°é•¿åº¦é™åˆ¶ï¼ˆ6ä¸ªå­—ç¬¦ï¼‰

### 3. å®¡è®¡è¿½è¸ª
- âœ… å¯†ç é‡ç½®ä¼šæ›´æ–° `updatedAt` å­—æ®µ
- âœ… å»ºè®®ï¼šæ·»åŠ æ“ä½œæ—¥å¿—è®°å½•é‡ç½®è¡Œä¸º

### 4. ç”¨æˆ·ä½“éªŒ
- âœ… é‡ç½®åç”¨æˆ·éœ€è¦ä½¿ç”¨æ–°å¯†ç ç™»å½•
- âœ… æ‰€æœ‰ç°æœ‰çš„ç™»å½•ä¼šè¯ä¼šå¤±æ•ˆï¼ˆJWT éªŒè¯å¤±è´¥ï¼‰
- âœ… ç”¨æˆ·å¯ä»¥åœ¨é¦–æ¬¡ç™»å½•åä¿®æ”¹å¯†ç 

---

## ğŸ¨ ç•Œé¢æˆªå›¾è¯´æ˜

### ç”¨æˆ·ç®¡ç†é¡µé¢
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·ç®¡ç†                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç”¨æˆ·å  â”‚ è§’è‰² â”‚ çŠ¶æ€ â”‚ æ“ä½œ                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ user1   â”‚ USER â”‚ å¯ç”¨ â”‚ ç¦ç”¨ | é‡ç½®å¯†ç  | åˆ é™¤           â”‚
â”‚ user2   â”‚ USER â”‚ å¯ç”¨ â”‚ ç¦ç”¨ | é‡ç½®å¯†ç  | åˆ é™¤           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é‡ç½®å¯†ç å¼¹çª—
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é‡ç½®ç”¨æˆ·å¯†ç                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç”¨æˆ·ï¼šuser1                                   â”‚
â”‚ âš ï¸ é‡ç½®åï¼Œè¯¥ç”¨æˆ·éœ€è¦ä½¿ç”¨æ–°å¯†ç ç™»å½•           â”‚
â”‚                                               â”‚
â”‚ æ–°å¯†ç ï¼š                                      â”‚
â”‚ [â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢]                                 â”‚
â”‚                                               â”‚
â”‚ ç¡®è®¤æ–°å¯†ç ï¼š                                  â”‚
â”‚ [â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢]                                 â”‚
â”‚                                               â”‚
â”‚ [ç¡®è®¤é‡ç½®]  [å–æ¶ˆ]                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ ä»£ç ç¤ºä¾‹

### å‰ç«¯è°ƒç”¨ç¤ºä¾‹

```typescript
const resetUserPassword = async (userId: string, newPassword: string) => {
  try {
    const response = await fetch(
      `/api/admin/users/${userId}/reset-password`,
      {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ newPassword }),
      }
    )

    const data = await response.json()

    if (!response.ok) {
      throw new Error(data.error || 'é‡ç½®å¯†ç å¤±è´¥')
    }

    return data
  } catch (error) {
    console.error('Reset password error:', error)
    throw error
  }
}
```

### åç«¯å¤„ç†ç¤ºä¾‹

```typescript
// src/app/api/admin/users/[id]/reset-password/route.ts
export async function POST(request, { params }) {
  // 1. éªŒè¯ç®¡ç†å‘˜æƒé™
  const session = await requireAdmin()
  
  // 2. è§£æè¯·æ±‚æ•°æ®
  const { newPassword } = await request.json()
  
  // 3. éªŒè¯å¯†ç æ ¼å¼
  if (newPassword.length < 6) {
    return NextResponse.json(
      { error: 'å¯†ç è‡³å°‘éœ€è¦6ä¸ªå­—ç¬¦' },
      { status: 400 }
    )
  }
  
  // 4. åŠ å¯†å¯†ç 
  const hashedPassword = await hashPassword(newPassword)
  
  // 5. æ›´æ–°æ•°æ®åº“
  await prisma.user.update({
    where: { id: params.id },
    data: { password: hashedPassword },
  })
  
  return NextResponse.json({ success: true })
}
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### ç®¡ç†å‘˜é¡»çŸ¥

1. **è°¨æ…æ“ä½œ**
   - é‡ç½®å¯†ç ä¼šå½±å“ç”¨æˆ·ç™»å½•
   - ç¡®ä¿é€šè¿‡å®‰å…¨æ¸ é“å‘ŠçŸ¥ç”¨æˆ·æ–°å¯†ç 
   - å»ºè®®è®©ç”¨æˆ·é¦–æ¬¡ç™»å½•åç«‹å³ä¿®æ”¹å¯†ç 

2. **ä¸è¦é‡ç½®è‡ªå·±çš„å¯†ç **
   - ç³»ç»Ÿä¼šé˜»æ­¢ç®¡ç†å‘˜é‡ç½®è‡ªå·±çš„å¯†ç 
   - å¦‚éœ€ä¿®æ”¹è‡ªå·±çš„å¯†ç ï¼Œè¯·ä½¿ç”¨"ä¿®æ”¹å¯†ç "åŠŸèƒ½

3. **å¯†ç å¤æ‚åº¦**
   - è™½ç„¶ç³»ç»Ÿåªè¦æ±‚6ä¸ªå­—ç¬¦
   - ä½†å»ºè®®è®¾ç½®æ›´å¤æ‚çš„å¯†ç 
   - ä¾‹å¦‚ï¼šåŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—ã€ç‰¹æ®Šå­—ç¬¦

### ç”¨æˆ·é¡»çŸ¥

1. **æ”¶åˆ°æ–°å¯†ç å**
   - è¯·å¦¥å–„ä¿ç®¡æ–°å¯†ç 
   - é¦–æ¬¡ç™»å½•åå»ºè®®ç«‹å³ä¿®æ”¹
   - ä¸è¦ä¸ä»–äººåˆ†äº«å¯†ç 

2. **å¯†ç ä¿®æ”¹**
   - ç™»å½•åå¯åœ¨ä¸ªäººè®¾ç½®ä¸­ä¿®æ”¹å¯†ç 
   - æ–°å¯†ç è‡³å°‘6ä¸ªå­—ç¬¦
   - å»ºè®®ä½¿ç”¨å¼ºå¯†ç 

---

## ğŸ”§ æ‰©å±•åŠŸèƒ½ï¼ˆæœªæ¥è®¡åˆ’ï¼‰

### 1. å¯†ç ç”Ÿæˆå™¨
- è‡ªåŠ¨ç”Ÿæˆå®‰å…¨çš„éšæœºå¯†ç 
- ä¸€é”®å¤åˆ¶åˆ°å‰ªè´´æ¿
- å¯è‡ªå®šä¹‰å¯†ç é•¿åº¦å’Œå¤æ‚åº¦

### 2. å¯†ç å†å²
- è®°å½•å¯†ç ä¿®æ”¹å†å²
- é˜²æ­¢é‡å¤ä½¿ç”¨æ—§å¯†ç 
- å®¡è®¡è¿½è¸ª

### 3. é€šçŸ¥åŠŸèƒ½
- å¯†ç é‡ç½®åè‡ªåŠ¨å‘é€é‚®ä»¶é€šçŸ¥
- åŒ…å«æ–°å¯†ç æˆ–é‡ç½®é“¾æ¥
- å®‰å…¨æé†’

### 4. æ‰¹é‡æ“ä½œ
- æ‰¹é‡é‡ç½®å¤šä¸ªç”¨æˆ·çš„å¯†ç 
- å¯¼å‡ºå¯†ç åˆ—è¡¨ï¼ˆåŠ å¯†ï¼‰
- æ‰¹é‡é€šçŸ¥ç”¨æˆ·

### 5. æ“ä½œæ—¥å¿—
- è®°å½•è°åœ¨ä»€ä¹ˆæ—¶å€™é‡ç½®äº†è°çš„å¯†ç 
- æ˜¾ç¤ºåœ¨ç®¡ç†å‘˜æ—¥å¿—ä¸­
- ç”¨äºå®‰å…¨å®¡è®¡

---

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜ 1ï¼šç‚¹å‡»"é‡ç½®å¯†ç "æŒ‰é’®æ— ååº”

**åŸå› **ï¼šå¯èƒ½æ˜¯è¯¥ç”¨æˆ·æ˜¯å½“å‰ç™»å½•çš„ç®¡ç†å‘˜

**è§£å†³**ï¼šç®¡ç†å‘˜ä¸èƒ½é‡ç½®è‡ªå·±çš„å¯†ç ï¼Œè¯·ä½¿ç”¨ä¿®æ”¹å¯†ç åŠŸèƒ½

---

### é—®é¢˜ 2ï¼šæç¤º"å¯†ç è‡³å°‘éœ€è¦6ä¸ªå­—ç¬¦"

**åŸå› **ï¼šè¾“å…¥çš„å¯†ç å¤ªçŸ­

**è§£å†³**ï¼šè¾“å…¥è‡³å°‘6ä¸ªå­—ç¬¦çš„å¯†ç 

---

### é—®é¢˜ 3ï¼šæç¤º"ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´"

**åŸå› **ï¼šæ–°å¯†ç å’Œç¡®è®¤å¯†ç ä¸åŒ¹é…

**è§£å†³**ï¼šç¡®ä¿ä¸¤ä¸ªå¯†ç è¾“å…¥æ¡†çš„å†…å®¹å®Œå…¨ä¸€è‡´

---

### é—®é¢˜ 4ï¼šæç¤º"éœ€è¦ç®¡ç†å‘˜æƒé™"

**åŸå› **ï¼šå½“å‰ç”¨æˆ·ä¸æ˜¯ç®¡ç†å‘˜

**è§£å†³**ï¼šç¡®ä¿ä½¿ç”¨ç®¡ç†å‘˜è´¦æˆ·ç™»å½•

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ç”¨æˆ·ç®¡ç†åŠŸèƒ½](./archive/USER_MANAGEMENT.md)
- [ç®¡ç†å‘˜è®¾ç½®](./archive/ADMIN_SETUP.md)
- [è§’è‰²æƒé™è¯´æ˜](./archive/ROLES.md)

---

## ğŸ“§ åé¦ˆä¸å»ºè®®

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- GitHub Issues: https://github.com/goushuai888/health-calculator/issues
- é¡¹ç›®ä»“åº“: https://github.com/goushuai888/health-calculator

---

**æœ€åæ›´æ–°**ï¼š2025-11-08

